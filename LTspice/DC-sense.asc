Version 4
SHEET 1 2360 680
WIRE 1088 0 848 0
WIRE 1088 16 1088 0
WIRE 848 48 848 0
WIRE 1088 112 1088 96
WIRE 1248 112 1088 112
WIRE 1360 112 1248 112
WIRE 1440 112 1360 112
WIRE 1088 128 1088 112
WIRE 1248 128 1248 112
WIRE 1360 128 1360 112
WIRE 1440 128 1440 112
WIRE 576 160 432 160
WIRE 848 160 848 128
WIRE 848 160 576 160
WIRE 432 192 432 160
WIRE 848 208 848 160
WIRE 1088 224 1088 208
WIRE 1248 224 1248 192
WIRE 1248 224 1088 224
WIRE 1360 224 1360 192
WIRE 1360 224 1248 224
WIRE 1440 224 1440 208
WIRE 1440 224 1360 224
WIRE 1648 224 1440 224
WIRE 1088 240 1088 224
WIRE 1648 288 1648 224
WIRE 432 304 432 272
WIRE 848 336 848 288
WIRE 1088 336 1088 320
WIRE 1088 336 848 336
FLAG 1648 288 0
FLAG 1648 224 MCU_GND
FLAG 432 304 0
FLAG 576 160 Vcm
SYMBOL voltage 848 32 R0
WINDOW 123 29 92 Left 2
WINDOW 39 0 0 Left 0
WINDOW 3 39 45 Left 2
SYMATTR Value2 AC 1
SYMATTR Value {Vdc/2}
SYMATTR InstName V1
SYMBOL res 1072 0 R0
SYMATTR InstName R5
SYMATTR Value 660k
SYMBOL res 1072 112 R0
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL res 1072 224 R0
SYMATTR InstName R7
SYMATTR Value 660k
SYMBOL cap 1232 128 R0
SYMATTR InstName C2
SYMATTR Value 4.7µ
SYMBOL cap 1344 128 R0
SYMATTR InstName C3
SYMATTR Value 6p
SYMBOL res 1424 112 R0
SYMATTR InstName R8
SYMATTR Value 10Meg
SYMBOL voltage 432 176 R0
WINDOW 123 38 41 Left 2
WINDOW 39 0 0 Left 0
WINDOW 3 34 75 Left 2
SYMATTR Value2 AC 0
SYMATTR Value SINE(0 {Vac_amp/2} 50)
SYMATTR InstName V3
SYMBOL voltage 848 192 R0
WINDOW 123 29 92 Left 2
WINDOW 39 0 0 Left 0
WINDOW 3 39 45 Left 2
SYMATTR Value2 AC 1
SYMATTR Value {Vdc/2}
SYMATTR InstName V2
TEXT 752 -352 Left 2 ;Battery Vdc measurement\nV4: 2x330k THT + 2x330k SMD\nC=4.7uF\n3,3V×((2×660+10)÷10) = 438.9V\n-> fg=3.7Hz
TEXT 1344 64 Left 2 ;STM32 Input\ninternal sample and hold capacitor has 4pF
TEXT -8 544 Left 2 ;possible problem: GND/PE coupling\n-> use Philipp Swoboda single ended to differential conversion with high impedance input. \nThis also uses full 2x3.3V differential range of STM32 ADC
TEXT 88 -576 Left 2 ;Human Body Model max 3mA\nVbat and Vdc measurement voltage divider max 1.5mA each.\nmax Voltage = 96*4.25V = 408V\nmin. R = 408V/1.5mA = 272kOhm
TEXT -368 -368 Left 2 ;GaN FB Cell Vdc measurement\nV1:\nC=2.2nF\n3,3V×((2×470+7,5)÷7,5) = 416.9V\n-> fg=9.7kHz\n-> Groupdelay@100Hz = 16.4us\n \nV2: 2x220k THT + 2x180k SMD\nC=2.2nF\n3,3V×((2×400+6.2)÷6.2) = 429.1V\n-> fg=11.7kHz\n-> Groupdelay@100Hz = 13.6us
TEXT 632 -64 Left 2 !.param Vdc=400 Vac_amp=325
TEXT 824 472 Left 2 ;.ac dec 2000 50 200k
TEXT -368 -8 Left 2 ;Battery Vdc measurement\nV3: 2x220k THT + 2x180k SMD\nC=3.3nF\n3,3V×((2×400+6.2)÷6.2) = 429.1V\n-> fg=7.8kHz\n-> Groupdelay@100Hz = 20.3us
TEXT 832 504 Left 2 ;.ac dec 2000 10 50k
TEXT 816 400 Left 2 ;.tran 0 .5 0
TEXT 1056 408 Left 2 !.tran 0 .5 0
